window.tinymce.PluginManager.add("editorial_comment_quote",(function(e){let t;e.addButton("editorialCommentQuoteButton",{icon:"dashicon dashicons-format-quote",classes:"widget btn primary",tooltip:PRHelper.getSetting().getOption("editorial_comment.text.qoute_action_tooltip"),onclick:function(){const n=e.selection.getContent({format:"text"}),o=function(e){const t=e.selection.getRng(),n=e.getBody();let o=0,i=!1,r=!1,d=-1,a=-1;function c(e){if(!r)if(3===e.nodeType)i||e!==t.startContainer||(d=o+t.startOffset,i=!0),e===t.endContainer&&(a=o+t.endOffset,r=!0),o+=e.textContent.length;else if(1===e.nodeType&&e.childNodes.length>0)for(let t of e.childNodes)if(c(t),r)break}return c(n),{start:d,end:a}}(e);PRHelper.getHook().doAction("editorial_comment_qoute_clicked",n,o),t&&t.hide&&t.hide(),e.focus(),e.nodeChanged()}}),e.on("preinit",(function(){e.wp&&e.wp._createToolbar?t=e.wp._createToolbar(["editorialCommentQuoteButton"],!0):console.error("WordPress TinyMCE API (editor.wp._createToolbar) not found.")})),e.on("wptoolbar",(function(n){if(!t)return;let o=e.selection;if(!o.isCollapsed()&&""!==o.getContent({format:"text"}).trim()){if(!function(t){const n=t.commonAncestorContainer,o=1===n.nodeType?n:n.parentElement;if(!o)return!1;const i=t.startContainer,r=t.endContainer,d=1===i.nodeType?i:i.parentElement,a=1===r.nodeType?r:r.parentElement;if(!o.contains(d)||!o.contains(a))return!1;const c=e.dom.getParent(o,e.dom.isBlock),l=e.dom.getParent(d,e.dom.isBlock),s=e.dom.getParent(a,e.dom.isBlock);return c&&l===c&&s===c}(o.getRng()))return;let i=o.getNode();i&&(3===i.nodeType&&(i=i.parentNode),n.element=i,n.toolbar=t)}})),e.on("SelectionChange",(function(){e.nodeChanged()})),e.on("blur",(function(){t&&t.visible&&t.visible()&&t.hide&&t.hide()}))}));