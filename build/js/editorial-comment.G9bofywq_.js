/*! For license information please see editorial-comment.G9bofywq_.js.LICENSE.txt */
(()=>{var e={105:(e,t,o)=>{"use strict";o.r(t)}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,o),l.exports}o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o(105),function(){const e=PRHelper.getHTML(),t=PRHelper.getHook(),o=PRHelper.getType(),n=PRHelper.getRequest(),i=PRHelper.getSetting();let l=!1,r=null,a=null,c=1,s=!1;function m(t,o){const n=e.getElement(".editorial-comment-form");d();const i=e.getElement(".editorial-comment-action-placeholder",n);e.fadeIn(i,{start:()=>{const n=e.getElement(".editorial-comment-action-label",i),l=e.getElement(".editorial-comment-action-text",i);e.setText(n,o),e.setText(l,t)}}),e.scrollTo(n),e.getElement("#editorial_comment_content_input",n).focus({focusVisible:!0})}function d(t=!1){const o=e.getElement(".editorial-comment-form"),n=e.getElement(".editorial-comment-action-placeholder",o),i=e.getElement(".editorial-comment-action-label",n),l=e.getElement(".editorial-comment-action-text",n),c=e.getElement("#editorial_comment_id",o),s=e.getElement("#editorial_comment_reply_id",o),m=e.getElement("#editorial_comment_content_input",o),d=e.getElement("#editorial_comment_quote_text",o),g=e.getElement("#editorial_comment_quote_end_offset",o),u=e.getElement("#editorial_comment_quote_start_offset",o);"edit"===r&&e.setValue(m,""),e.setValue(c,""),e.setValue(s,""),e.setValue(d,""),e.setValue(g,""),e.setValue(u,""),t?e.fadeOut(n,{end:()=>{e.empty(i),e.empty(l)}}):(e.hide(n),e.empty(i),e.empty(l)),r=null,a=null}t.on("input change",((t,o)=>{o.style.height="auto",o.style.height=o.scrollHeight+"px";const n=o.value.trim();e.setElementActivity("#edirotial_comment_submit_action",""!==n,!1)}),"#editorial_comment_content_input"),t.on("DOMContentLoaded",(()=>{e.scrollElementTo(".pr-editorial-comment-list")})),t.on("click",((t,l)=>{const a=e.getElement(".pr-editorial-comment-list"),c=e.getElement("#editorial_comment_content_input");if(e.isElement(c)){const t=e.getValue(c);if(o.isEmpty(t))PRBackendHelper.getModal().show({type:"warning",title:i.getOption("editorial_comment.title.empty_text",""),content:i.getOption("editorial_comment.message.empty_text","")});else{e.setElementActivity(l);const s=e.getValue("input#editorial_comment_id");let m={text:t,id:s,post_id:e.getValue("input#editorial_comment_post_id"),reply_id:e.getValue("input#editorial_comment_reply_id")};const g=e.getValue("input#editorial_comment_quote_text");o.isEmpty(g)||(m.quote={text:g,end_offset:e.getValue("input#editorial_comment_quote_end_offset"),start_offset:e.getValue("input#editorial_comment_quote_start_offset")}),n.ajax(i.getOption("editorial_comment.ajax.submit_comment")).addNonce().onSuccess((t=>{if(e.isElement(a)){let o=!0;if(e.getElement(".pr-editorial-comment-empty",a))e.replace(t,a);else if("edit"===r&&s){const n=e.getElement("#editorial_comment_"+s,a);e.isElement(n)&&e.replace(t,n,!0),o=!1}else e.append(t,a);o&&e.scrollElementTo(a)}e.setElementActivity(l,!0),e.setValue(c,""),d(!0)})).onError((t=>{PRBackendHelper.getModal().show({type:"warning",content:PRHelper.getTool().error2string(t)}),e.setElementActivity(l,!0)})).send(m)}}}),"#edirotial_comment_submit_action"),t.on("click",(()=>d(!0)),".editorial-comment-action-clear"),t.on("click",((t,r)=>{if(l||s)return;const a=e.getElement(".pr-editorial-comment-list"),m=e.getElement(".pr-editorial-comment-items",a);l=!0,e.setElementActivity(r,!1,!0);const d=a.scrollHeight;n.ajax(i.getOption("editorial_comment.ajax.get_comments")).addNonce().onSuccess((t=>{o.each(t.items,(t=>{e.prepend(t,m)})),a.scrollTop+=a.scrollHeight-d,c++,t.pagination.pages<=c&&(r.remove(),s=!0)})).onError((e=>{PRBackendHelper.getModal().show({type:"warning",content:PRHelper.getTool().error2string(e)})})).onFinally((()=>{l=!1,e.setElementActivity(r,!0,!0)})).send({page:c+1,post_id:e.getValue("input#editorial_comment_post_id")})}),".pr-editorial-comment-load-more"),t.bubbling("click",((t,o)=>{!function(t,o,n){t=t.trim();const i=tinymce.get("content");if(!i)return;const l=i.getContainer();l&&l.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((function(){i.focus();const n=i.getBody(),l=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return NodeFilter.FILTER_SKIP;const t=e.nodeName.toLowerCase(),o=["p","div","li","h1","h2","h3","h4","h5","h6"];if(!o.includes(t))return NodeFilter.FILTER_SKIP;if(!e.textContent||""===e.textContent.trim())return NodeFilter.FILTER_REJECT;for(let t of e.children){const e=t.nodeName.toLowerCase();if(o.includes(e))return NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT};let r,a=i.dom.doc.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:l},!1),c=0,s=[];for(;r=a.nextNode();){const e=r.textContent;if(0===e.length)continue;let o=-1,n=-1;for(;-1!==(o=e.indexOf(t,n+1));){const e=c+o;t.length,s.push({node:r,startIndexInBlockText:o,endIndexInBlockText:o+t.length,globalStartOffset:e,textMatched:t}),n=o}c+=e.length}let m=null;const d=parseInt(o,10);if(0!==s.length){if(1===s.length)m=s[0];else{let e=1/0,t=null;for(let o=0;o<s.length;o++){const n=Math.abs(s[o].globalStartOffset-d);n<e&&(e=n,t=s[o])}m=t,m||(m=s[0])}if(m){const t=function(e,t,o,n){const i=e.dom.createRng();let l=0,r=null,a=0,c=null,s=0,m=!1;const d=e.dom.doc.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let g;for(;g=d.nextNode();){const e=g.nodeValue.length;if(0!==e){if(!m&&o>=l&&o<l+e&&(r=g,a=o-l,m=!0),m&&n>l&&n<=l+e){c=g,s=n-l;break}l+=e}}if(r&&c)try{return i.setStart(r,a),i.setEnd(c,s),i}catch(e){return console.error("Error setting range: ",e,{startNode:r,startOffsetInNode:a,endNode:c,endOffsetInNode:s}),null}return console.warn("Could not create precise range in parent.",{parentElement:t,textOffsetStart:o,textOffsetEnd:n}),null}(i,m.node,m.startIndexInBlockText,m.endIndexInBlockText);if(!t||t.collapsed)return void console.warn("Could not create a valid range for highlighting.",m);i.selection.setRng(t);const o="temp-highlight-"+Date.now()+"-"+Math.random().toString(36).substr(2,5),n=e.createElement("<span></span>",{id:o,class:"editorial-comment-quote-highlisht",style:{backgroundColor:"yellow",transition:"background-color 1s"}});try{i.focus(),t.surroundContents(n),i.nodeChanged(),i.selection.getSel().removeAllRanges(),n&&(n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout((function(){n.parentNode&&(e.updateAttribute(n,{style:{backgroundColor:"transparent"}}),setTimeout((()=>{const e=n.parentNode;for(;n.firstChild;)e.insertBefore(n.firstChild,n);e.removeChild(n),i.nodeChanged()}),1e3))}),1e3))}catch(e){console.error("Error surrounding contents for highlight:",e)}}}}),200)}(e.getText(o),e.getData(o,"start-offset"),e.getData(o,"end-offset"))}),".pr-comment-quote"),t.bubbling("click",((t,o)=>{t.preventDefault();const l=e.getData(o,"type"),c=e.getData(o,"id"),s=e.getElement("#editorial_comment_"+c),g=e.getElement(".pr-comment-text",s);if(e.isElement(s)){switch(l){case"reply":let t=i.getOption("editorial_comment.text.replying");t=PRHelper.getTool().sprintf(t,e.getText(e.getElement(".pr-comment-user",s))),m(e.getText(g),t),e.setValue("#editorial_comment_reply_id",c);break;case"edit":const o=e.getText(g);m(o,i.getOption("editorial_comment.text.editing")),e.setValue("#editorial_comment_id",c),e.setValue("#editorial_comment_content_input",o);break;case"delete":const l=PRBackendHelper.getModal().getCurrent();l.showSpinner(),n.ajax(i.getOption("editorial_comment.ajax.delete_comment")).addNonce().onSuccess((t=>{const o=e.getElement("#editorial_comment_"+c,".pr-editorial-comment-items");e.isElement(o)&&e.fadeOut(o,{end:()=>{o.remove()}}),d(!0),l.close(),PRBackendHelper.getHTML().toast({text:i.getOption("editorial_comment.message.deleted"),type:"success"})})).onError((e=>{l.showMessage(PRHelper.getTool().error2string(e))})).onFinally((()=>{l.hideSpinner()})).send({comment_id:c,post_id:e.getValue("input#editorial_comment_post_id")})}a=c,r=l}}),".editorial-comment-action"),t.addAction("editorial_comment_qoute_clicked",((t,o)=>{m(t,i.getOption("editorial_comment.text.inserting_quote")),e.setValue("#editorial_comment_quote_text",t),e.setValue("#editorial_comment_quote_end_offset",o.end),e.setValue("#editorial_comment_quote_start_offset",o.start)}))}()})();